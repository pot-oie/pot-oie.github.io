---
title: 'RSB：ARM 指令集中看似“冗余”的反向减法指令'
description: '在复习嵌入式系统设计时，发现 ARM 指令集中一条看似冗余的指令 RSB（Reverse Subtract），探讨其存在的意义和应用场景。'
pubDate: '12 12 2025'
# heroImage: '../../assets/XXX.jpg'
draft: false
category: 'learn' 
tags: ["ARM"]
---

> 在复习嵌入式系统设计时，发现 ARM 指令集中一条看似冗余的指令 RSB（Reverse Subtract），
>
> 似乎可以通过 SUB 指令交换操作数来实现相同的功能。
>
> 看起来好像违背了 ARM 的设计原则：“如果一个功能可以用现有的指令组合出来，就绝对不浪费硅片去设计一个新的电路。”
> 
> 本文将探讨 RSB 指令的应用场景和存在意义。

## RSB 指令
RSB（Reverse Subtract）指令用于执行反向减法操作，即计算 `operand2 - operand1`。

RSB 指令的基本语法如下：

```asm
RSB{S}{cond} Rd, Rn, Operand2
```
- `Rd`：目标寄存器，存储结果。
- `Rn`：第一个操作数寄存器。
- `Operand2`：第二个操作数，可以是立即数或寄存器。

公式实际上等同于 `Rd = Operand2 - Rn`。

## RSB 的应用场景

### 解决减法局限性（核心）
这是最最最重要的原因。

在 ARM 指令集中，立即数只能作为第二个操作数使用，无法直接作为第一个操作数参与减法运算。

**场景**： 计算 `100 - R0`。

- 尝试用 SUB： `SUB R1, #100, R0`

    - `Error!`，因为 `#100` 是立即数，不能放在第一个位置。

- 尝试用 SUB（换位置）： `SUB R1, R0, #100`

    - 算出来是 `R0 - 100`，不是我们要的结果。

**救世主 RSB**： 允许我们把寄存器放在第一个位置（Rn），把立即数放在第二个位置（Op2），但是执行反向减法。

- 代码： `RSB R1, R0, #100`
- 含义： `R1 = #100 - R0`
- 结果： 解决了“常数减变量”的问题。

### 快速求负数（取反）
如果想把 `R0` 变成 `-R0`（比如把 5 变成 -5）。

- 用 SUB： 先找个寄存器存 0，然后 `SUB R1, R2(存了0), R0`。太麻烦。
- 用 RSB： 一行代码搞定。
    ```asm
    RSB R0, R0, #0
    ```
    - 含义： `R0 = 0 - R0`
    - 标准的数学取负操作。

### 乘法优化（进阶）
配合移位指令，可以实现一些乘法优化。

**场景**：计算 `R0 = R1 * 7`。常规思路是使用 `MUL` 指令。
- 用 RSB 优化：
    ```asm
    RSB R0, R1, R1, LSL #3
    ```
- 解析：
    - `R1, LSL #3` 相当于 `R1 * 8`
    - `RSB` 实际上计算 `R1 * 8 - R1`，等同于 `R1 * 7`

这条指令实现了一个周期计算 `R1 * 7`，比传统的乘法指令更高效。