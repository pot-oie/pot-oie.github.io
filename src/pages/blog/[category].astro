---
// src/pages/blog/[category].astro

import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostCard from "../../components/PostCard.astro";
import { Icon } from "astro-icon/components";

export async function getStaticPaths() {
  const allPosts = await getCollection("blog");
  const uniqueCategories = [
    ...new Set(allPosts.map((post) => post.data.category)),
  ];
  return uniqueCategories.map((category) => {
    const filteredPosts = allPosts.filter(
      (post) => post.data.category.toLowerCase() === category
    );
    return {
      params: { category: category },
      props: {
        posts: filteredPosts,
      },
    };
  });
}

const { category } = Astro.params;
const { posts } = Astro.props;

const sortedPosts = posts.sort(
  (a, b) =>
    new Date(b.data.pubDate).valueOf() - new Date(a.data.pubDate).valueOf()
);

const categoryNames: Record<string, string> = {
  learn: "Notes / 学习",
  life: "Essays / 随笔",
};

// 页面标题逻辑
const displayTitle = categoryNames[category] || category;
---

<BaseLayout
  title={`Category: ${category}`}
  description={`Posts in ${category}`}
>
  <section class="py-20 md:py-32">
    {/* --- 头部：极简风格 --- */}
    <div
      class="mb-20 px-4 text-center md:text-left border-b border-ink-900 pb-8"
    >
      <div
        class="flex items-center justify-center md:justify-start gap-2 text-ink-500 mb-4 text-sm tracking-widest uppercase"
      >
        <a href="/" class="hover:text-vermilion transition-colors">Home</a>
        <span>/</span>
        <span class="text-ink-900">Category</span>
      </div>

      <h1
        class="text-5xl md:text-7xl font-serif font-bold text-ink-900 mb-6 tracking-tight"
      >
        {displayTitle}
      </h1>

      <div
        class="flex items-center justify-center md:justify-start gap-3 text-ink-500"
      >
        <Icon name="mingcute:quill-pen-line" class="w-5 h-5" />
        <p class="font-serif italic text-lg">
          {posts.length}
          {posts.length === 1 ? "entry" : "entries"} collected.
        </p>
      </div>
    </div>

    {/* --- 列表区域：复用新的 PostCard --- */}
    <div class="flex flex-col max-w-4xl mx-auto">
      {sortedPosts.map((post) => <PostCard post={post} />)}
    </div>

    {/* 底部导航 */}
    <div class="mt-20 text-center">
      <a
        href="/blog"
        class="inline-flex items-center gap-2 text-ink-500 hover:text-vermilion transition-colors text-sm tracking-widest uppercase"
      >
        <Icon name="mingcute:arrow-left-line" />
        <span>Back to All Archives</span>
      </a>
    </div>
  </section>
</BaseLayout>
