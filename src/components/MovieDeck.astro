---
// src/components/MovieDeck.astro
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";
import FormattedDate from "./FormattedDate.astro";
import type { CollectionEntry } from "astro:content";

export interface Props {
  posts: CollectionEntry<"movie">[];
}

const { posts } = Astro.props;

// 评分星级生成
function generateStars(rating: number) {
  let stars = [];
  for (let i = 0; i < 5; i++) {
    if (rating >= i + 1) {
      stars.push({ name: "mingcute:star-fill", color: "text-amber-400" });
    } else if (rating > i) {
      stars.push({ name: "mingcute:star-half-fill", color: "text-amber-400" });
    } else {
      stars.push({ name: "mingcute:star-line", color: "text-amber-400" });
    }
  }
  return stars;
}

const totalCards = posts.length; // 获取卡片总数
---

<div class="movie-deck-container">
  <ul class="movie-deck">
    {
      posts.map((post, index) => (
        <li
          class="movie-deck-card"
          style={`--i: ${index}; --total-cards: ${totalCards};`}
        >
          <a href={`/movie/${post.id.replace(/\.mdx?$/, "")}/`}>
            <Image
              src={post.data.coverImage}
              alt={post.data.title}
              width={200}
              height={300}
              loading="lazy"
              densities={[1.5, 2]}
              class="block w-full h-full object-cover"
            />
            <div class="card-content">
              <h4 class="card-title">{post.data.title}</h4>
              <div class="card-rating mt-1">
                {generateStars(post.data.rating).map((star) => (
                  <Icon
                    name={star.name}
                    class={`w-4 h-4 mr-0.5 ${star.color}`}
                  />
                ))}
                <span class="ml-1 text-sm">{post.data.rating.toFixed(1)}</span>
              </div>
            </div>
          </a>
        </li>
      ))
    }
  </ul>
</div>
