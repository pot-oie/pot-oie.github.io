---
// src/components/PostCard.astro
import { Image } from "astro:assets";
import FormattedDate from "./FormattedDate.astro";
import type { CollectionEntry } from "astro:content";

interface Props {
  post: CollectionEntry<"blog">;
}

const { post } = Astro.props;
const slug = post.id.replace(/\.mdx?$/, "");
---

<a
  href={`/blog/${slug}/`}
  class="group relative block py-12 border-t border-ink-300/30 first:border-t-0 transition-all duration-500 hover:pl-4"
>
  {
    /* 悬停时的背景图效果 (Ghost Image) 
      - 默认透明 opacity-0
      - 悬停显示 opacity-15 (极淡)
      - 混合模式 mix-blend-multiply 模拟水墨渗入纸张
      - 灰度处理 grayscale 保持克制
  */
  }
  {
    post.data.coverImage && (
      <div class="absolute right-0 top-1/2 -translate-y-1/2 h-[120%] w-2/3 md:w-1/2 opacity-0 group-hover:opacity-15 transition-opacity duration-700 ease-out pointer-events-none mix-blend-multiply grayscale blur-[1px] overflow-hidden select-none z-0">
        <Image
          src={post.data.coverImage}
          alt=""
          width={800}
          class="w-full h-full object-cover mask-image-gradient"
        />
      </div>
    )
  }

  {/* 内容区域 - z-index 确保文字在图片之上 */}
  <div
    class="relative z-10 flex flex-col md:flex-row gap-4 md:items-baseline md:justify-between"
  >
    <h3
      class="text-3xl md:text-4xl font-serif font-bold text-ink-900 group-hover:text-vermilion transition-colors duration-300"
    >
      {post.data.shortTitle || post.data.title}
    </h3>

    <div
      class="shrink-0 font-sans text-sm text-ink-300 font-medium tracking-widest uppercase group-hover:text-ink-500 transition-colors"
    >
      <FormattedDate date={post.data.pubDate} />
    </div>
  </div>

  <p
    class="relative z-10 mt-4 max-w-2xl text-ink-500 text-lg leading-relaxed line-clamp-2 group-hover:text-ink-700 transition-colors duration-300"
  >
    {post.data.description}
  </p>

  {/* 装饰性箭头，悬停时浮现 */}
  <div
    class="relative z-10 mt-6 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300 text-vermilion"
  >
    <span class="text-sm font-bold tracking-widest">READ MORE &rarr;</span>
  </div>
</a>

<style>
  /* 图片蒙版，让图片左边缘淡出，不生硬 */
  .mask-image-gradient {
    -webkit-mask-image: linear-gradient(to right, transparent, black 40%);
    mask-image: linear-gradient(to right, transparent, black 40%);
  }
</style>
