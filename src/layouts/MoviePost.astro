---
// src/layouts/MoviePost.astro

import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import BaseLayout from "./BaseLayout.astro";
import FormattedDate from "../components/FormattedDate.astro";
import { Icon } from "astro-icon/components";

type Props = CollectionEntry<"movie">["data"];

const { title, coverImage, rating, viewingDate, releaseDate, shortReview } =
  Astro.props;

function generateStars(rating: number) {
  const totalStars = 5;
  const stars = [];
  for (let i = 1; i <= totalStars; i++) {
    if (rating >= i) stars.push("mingcute:star-fill");
    else if (rating >= i - 0.5) stars.push("mingcute:star-half-fill");
    else stars.push("mingcute:star-line");
  }
  return stars;
}
const starIcons = generateStars(rating);
---

<BaseLayout title={title} description={shortReview}>
  <article class="py-16 md:py-24">
    <div class="prose">
      {
        coverImage && (
          <div class="hidden md:block float-right ml-8 mb-6 w-1/3 max-w-[250px]">
            <Image
              width={400}
              height={600}
              src={coverImage}
              alt={title}
              class="rounded-lg shadow-xl"
            />
          </div>
        )
      }

      <h1
        class="text-4xl md:text-5xl font-bold text-zinc-900 dark:text-zinc-100"
      >
        {title}
      </h1>

      <div class="flex items-center text-yellow-400 my-4">
        {starIcons.map((iconName) => <Icon name={iconName} class="w-6 h-6" />)}
        <span class="ml-3 text-2xl text-zinc-700 dark:text-zinc-300">
          {rating.toFixed(1)}
        </span>
      </div>

      {/* 移动端显示的封面 */}
      {
        coverImage && (
          <div class="block md:hidden my-6">
            <Image
              width={400}
              height={600}
              src={coverImage}
              alt={title}
              class="rounded-lg shadow-xl w-full max-w-[300px] mx-auto"
            />
          </div>
        )
      }

      <div
        class="text-base text-zinc-500 dark:text-zinc-400 space-y-1 my-6 border-l-2 border-primary-500/30 pl-4"
      >
        <p>
          <strong>观看于:</strong>
          <FormattedDate date={viewingDate} />
        </p>
        {
          releaseDate && (
            <p>
              <strong>上映于:</strong> <FormattedDate date={releaseDate} />
            </p>
          )
        }
      </div>

      {
        shortReview && (
          <blockquote class="text-zinc-700 dark:text-zinc-300">
            {shortReview}
          </blockquote>
        )
      }

      <hr class="my-8 border-zinc-200 dark:border-zinc-700" />

      <div class="text-zinc-800 dark:text-zinc-200">
        <slot />
      </div>
    </div>
  </article>
</BaseLayout>
